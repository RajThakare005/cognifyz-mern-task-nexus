<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(120deg, #edf7ff, #ffffff);
      }
      .hero {
        animation: fadeInUp 0.7s ease;
      }
      .card {
        border-radius: 16px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(13, 38, 76, 0.12);
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .weak {
        color: #b42318;
      }
      .medium {
        color: #b54708;
      }
      .strong {
        color: #067647;
      }
    </style>
  </head>
  <body>
    <main class="container py-4">
      <section class="hero mb-4">
        <h1 class="display-6 fw-bold">Internship Task Form (SSR + Validation)</h1>
        <p class="text-secondary">Tasks 1-4 demo with Express + EJS + inline JS + Bootstrap.</p>
      </section>

      <% if (errors && errors.length) { %>
      <div class="alert alert-danger">
        <ul class="mb-0">
          <% errors.forEach((error) => { %>
          <li><%= error %></li>
          <% }) %>
        </ul>
      </div>
      <% } %>

      <div class="row g-4">
        <section class="col-lg-7">
          <article class="card p-3">
            <h2 class="h5 mb-3">Candidate Form</h2>
            <form id="candidateForm" method="POST" action="/submit" novalidate>
              <div class="mb-3">
                <label class="form-label">Name</label>
                <input class="form-control" type="text" name="name" value="<%= values.name || '' %>" required />
              </div>
              <div class="mb-3">
                <label class="form-label">Email</label>
                <input class="form-control" type="email" name="email" value="<%= values.email || '' %>" required />
              </div>
              <div class="mb-3">
                <label class="form-label">Password</label>
                <input id="password" class="form-control" type="password" name="password" required />
                <small id="passwordStrength" class="d-block mt-1"></small>
              </div>
              <div class="mb-3">
                <label class="form-label">Age</label>
                <input class="form-control" type="number" min="18" max="80" name="age" value="<%= values.age || '' %>" required />
              </div>
              <div class="mb-3">
                <label class="form-label">Role</label>
                <select class="form-select" name="role">
                  <option value="frontend" <%= values.role === 'frontend' ? 'selected' : '' %>>Frontend</option>
                  <option value="backend" <%= values.role === 'backend' ? 'selected' : '' %>>Backend</option>
                  <option value="fullstack" <%= values.role === 'fullstack' ? 'selected' : '' %>>Fullstack</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea class="form-control" name="notes" rows="3"><%= values.notes || '' %></textarea>
              </div>
              <button class="btn btn-primary" type="submit">Submit</button>
            </form>
          </article>
        </section>

        <section class="col-lg-5">
          <article class="card p-3" id="previewSection">
            <h2 class="h5">Dynamic Preview</h2>
            <p class="mb-1"><strong>Name:</strong> <span id="previewName">-</span></p>
            <p class="mb-1"><strong>Email:</strong> <span id="previewEmail">-</span></p>
            <p class="mb-0"><strong>Role:</strong> <span id="previewRole">-</span></p>
          </article>
          <article class="card p-3 mt-3">
            <h2 class="h5">Recent Temporary Submissions</h2>
            <% if (!submissions.length) { %>
            <p class="text-secondary mb-0">No data yet.</p>
            <% } else { %>
            <ul class="list-group list-group-flush">
              <% submissions.slice(0, 8).forEach((item) => { %>
              <li class="list-group-item px-0">
                <strong><%= item.name %></strong>
                <span class="text-secondary">(<%= item.email %>)</span>
                <div class="small text-secondary"><%= item.role %> | age <%= item.age %></div>
              </li>
              <% }) %>
            </ul>
            <% } %>
          </article>
        </section>
      </div>
    </main>

    <script>
      const form = document.getElementById("candidateForm");
      const pwd = document.getElementById("password");
      const indicator = document.getElementById("passwordStrength");

      const nameInput = form.querySelector("input[name='name']");
      const emailInput = form.querySelector("input[name='email']");
      const roleInput = form.querySelector("select[name='role']");

      const pName = document.getElementById("previewName");
      const pEmail = document.getElementById("previewEmail");
      const pRole = document.getElementById("previewRole");

      function scorePassword(v) {
        let score = 0;
        if (v.length >= 8) score++;
        if (/[A-Z]/.test(v)) score++;
        if (/[a-z]/.test(v)) score++;
        if (/\d/.test(v)) score++;
        if (/[^A-Za-z\d]/.test(v)) score++;
        return score;
      }

      function updateStrength() {
        const score = scorePassword(pwd.value);
        if (score <= 2) {
          indicator.textContent = "Weak password";
          indicator.className = "d-block mt-1 weak";
        } else if (score <= 4) {
          indicator.textContent = "Medium password";
          indicator.className = "d-block mt-1 medium";
        } else {
          indicator.textContent = "Strong password";
          indicator.className = "d-block mt-1 strong";
        }
      }

      function updatePreview() {
        pName.textContent = nameInput.value || "-";
        pEmail.textContent = emailInput.value || "-";
        pRole.textContent = roleInput.value || "-";
      }

      pwd.addEventListener("input", updateStrength);
      nameInput.addEventListener("input", updatePreview);
      emailInput.addEventListener("input", updatePreview);
      roleInput.addEventListener("change", updatePreview);

      form.addEventListener("submit", (e) => {
        if (scorePassword(pwd.value) < 5) {
          e.preventDefault();
          alert("Password is not strong enough.");
        }
      });

      updatePreview();
    </script>
  </body>
</html>
